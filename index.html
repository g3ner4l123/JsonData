<head>
    <style> body { margin: 0; } </style>
    <script src="//unpkg.com/3d-force-graph"></script>
</head>

<body>
<div id="3d-graph"></div>

<script type="module">
    const api_url = 'https://raw.githubusercontent.com/ob-algdatii-20ss/leistungsnachweis-adventure-time/develop/mockData.json?token=AKOYABHOMQFYRRQMI2SSOFC6YKIK6';
    import { UnrealBloomPass } from '//unpkg.com/three/examples/jsm/postprocessing/UnrealBloomPass.js';

    const bloomPass = new UnrealBloomPass();
    bloomPass.strength = 3;
    bloomPass.radius = 1;
    bloomPass.threshold = 0.1;

    async function getISS() {
        const response = await fetch(api_url);
        const data = await response.json();
        const nodeArray = new Array();
        const linkSources = new Array();
        const linkDestinations = new Array();
        const colorGroup = new Array();
        const names = new Array();
        for (var k in data.Nodes){
            nodeArray[k] = data.Nodes[k].Index;
            names[k] = nodeArray[k] + " (" + data.Nodes[k].Position.X + ", " + data.Nodes[k].Position.Y + ", " + data.Nodes[k].Position.Z + ")";
            if (k == 0){
                colorGroup[k] = 100;
            }
            else if (k = data.Nodes.length-1){
                colorGroup[k] = 50;
            }
            else {
                colorGroup[k] = 22;
            }
        }
        for (var k in data.Edges){
            linkSources[k] = data.Edges[k].Source;
            linkDestinations[k] = data.Edges[k].Destination;
        }



        console.log(nodeArray);
        console.log(linkSources);
        console.log(linkDestinations);
        const arrowNumber = new Array();
        arrowNumber[0] = 0;
        arrowNumber[1] = 10;
        const gData = {
            nodes: [...nodeArray.keys()].map(i => ({id: nodeArray[i], 'group':colorGroup[i], 'name': names[i]})),
            links: [...linkSources.keys()].map(i =>({"source": linkSources[i],"target": linkDestinations[i],"value": arrowNumber[i%2]}))

        };


        const Graph = ForceGraph3D()
        (document.getElementById('3d-graph'))
            .graphData(gData)
            .nodeLabel('name')
            .linkDirectionalParticles("value")
            .linkDirectionalParticleSpeed(d => d.value * 0.001)
            .nodeAutoColorBy('group');
        Graph.postProcessingComposer().addPass(bloomPass);

    }

    getISS();
</script>
</body>